#!/bin/sh

RED='\033[0;31m'
NC='\033[0m'
branch="$(git rev-parse --abbrev-ref HEAD)"

valid_branch_regex="^(feat|fix|tmp|)\/[a-z0-9-]+$"
max_branch_length=50
branch_naming_convention="Branch naming convention

               [type*]/[group]-[issue]-[description*]

   - type: task type (feat, fix, or tmp)
   - group (optional): task group
   - issue (optional): task ID from tracker
   - description: short task description
   - only lowercase letters, numbers, and '-'s
   - max length of $max_branch_length
"

# Enforce branch naming policy
if [[ ${#branch} -gt $max_branch_length ]] || [[ !$branch =~ $valid_branch_regex ]]
then
    echo "❌ ${RED}Invalid branch name. Please rename your branch adhearing to the following convention.${NC}
   $branch_naming_convention
    Example
                          git branch -m feat/ui-12-add-dark-mode"
    exit 1
fi

# Forbid committing to main
if [ "$branch" = "main" ]; then
  echo "❌ ${RED}Forbidden to commit to main branch. Please create branch and work there.${NC}
  $branch_naming_convention
   Example            
                    git checkout -b feat/ui-12-add-dark-mode"
  exit 1
fi

exit 0